#!/bin/bash

echo "POST_CHECKOUT START"

FULL_PREV_BRANCH="$(git rev-parse --symbolic-full-name @{-1})"

PREV_BRANCH=$(echo "$FULL_PREV_BRANCH" | cut -d'/' -f 3)
NEXT_BRANCH=$(git branch --show-current)

echo "PREV_BRANCH: $PREV_BRANCH"

echo "Checkout from $PREV_BRANCH to $NEXT_BRANCH"

ENV_PREV_FILE=.env.${PREV_BRANCH}
ENV_NEXT_FILE=.env.${NEXT_BRANCH}

echo "Files ==> prev env: $ENV_PREV_FILE - current env: $ENV_NEXT_FILE"

if test -f ".env"; then
    echo ".env exits."
    echo "START renaming .env to .env.$PREV_BRANCH"
    mv ./.env ./${ENV_PREV_FILE}
    echo "END renaming .env to .env.$PREV_BRANCH"
fi

if test -f "$ENV_NEXT_FILE"; then
    echo "$ENV_NEXT_FILE exits."
    echo "START renaming .env.$NEXT_BRANCH to .env"
    mv ./${ENV_NEXT_FILE} ./.env
    echo "END renaming .env.$NEXT_BRANCH to .env"
fi